import{r,u as P,A,j as e}from"./index-Cg-pIFFT.js";import{P as D}from"./ProfileNavigation-BwADHzNP.js";const T=[{id:"name",label:"Full name",type:"text",maxLength:16},{id:"profile_email",label:"Profile email",type:"email"},{id:"birth_date",label:"Birth date",type:"date"},{id:"mobile_number",label:"Mobile number",type:"tel"},{id:"address",label:"Address",type:"text"},{id:"city",label:"City",type:"text"},{id:"postal_code",label:"Postal code",type:"text"}];function E(){const[a,d]=r.useState(null),[b,n]=r.useState(""),[f,i]=r.useState(""),u=P(),[j,p]=r.useState(!1),v=()=>{const t=localStorage.getItem("token");fetch("https://hoodshop-project.onrender.com/user/profile",{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}).then(o=>o.json()).then(o=>{o.success?(C(),u("/login")):n(o.error||"Nepodarilo sa vymazať účet.")}).catch(()=>n("Chyba pri komunikácii so serverom."))},[h,g]=r.useState(null),[y,c]=r.useState(""),x=r.useRef(null),w=()=>{if(!h){c("Vyber fotku!"),setTimeout(()=>c(""),3e3);return}const t=localStorage.getItem("token"),o=new FormData;o.append("photo",h),fetch("https://hoodshop-project.onrender.com/user/upload/photo",{method:"POST",headers:{Authorization:"Bearer "+t},body:o}).then(l=>l.json()).then(l=>{l.success?(console.log("Fotka nahraná, cesta:",l.photo),d(s=>({...s,user_photo:l.photo})),g(null),x.current&&(x.current.value=""),i("Photo was uploaded successfully."),setTimeout(()=>i(""),3e3)):(c("Chybný obrázok."),setTimeout(()=>c(""),3e3))}).catch(()=>{c("Chybný obrázok."),setTimeout(()=>c(""),3e3)})},N=async()=>{try{const o=await(await fetch("https://hoodshop-project.onrender.com/user/upload/default-photo",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();o.success?(d(l=>({...l,user_photo:o.photo})),g(null),x.current&&(x.current.value="")):console.error("Chyba pri nastavovaní default fotky:",o.message)}catch(t){console.error("Server error:",t)}};r.useEffect(()=>{const t=localStorage.getItem("token");if(!t){u("/login");return}fetch("https://hoodshop-project.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${t}`}}).then(o=>o.json()).then(o=>{o.error?n(o.error):d(o)}).catch(()=>n("Chyba pri načítaní údajov o používateľovi"))},[u]);const k=t=>{const{name:o,value:l}=t.target;d(s=>({...s,[o]:l}))},S=()=>{const t=localStorage.getItem("token"),l=["name","email","profile_email","birth_date","mobile_number","address","city","postal_code"].reduce((s,m)=>(a[m]!==void 0&&(s[m]=a[m]),s),{});fetch("https://hoodshop-project.onrender.com/user/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(l)}).then(s=>s.json()).then(s=>{s.error?(n(s.error),i("")):(i("Profile was successfully saved."),n(""),d(m=>({...m,...s})),setTimeout(()=>{i("")},3e3))}).catch(()=>{n("Error saving profile."),i("")})},{logout:C}=r.useContext(A);return a?e.jsxs("div",{className:"relative text-white flex flex-col items-center bg-fixed bg-cover bg-no-repeat bg-center",style:{backgroundImage:"url('/img/bg-profile-1.jpg')"},children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-30 z-0"}),e.jsxs("div",{className:"relative z-10 w-full flex flex-col items-center",children:[b&&e.jsx("div",{className:"text-red-500 mb-4",children:b}),e.jsx("div",{className:"py-8 text-center bg-black w-full",children:e.jsxs("h1",{className:"text-2xl lg:text-4xl font-bold text-white",children:["Welcome ",e.jsx("span",{className:"text-blue-200",children:a.name})]})}),e.jsx("div",{className:"w-full lg:max-w-2xl",children:e.jsx(D,{})}),a.role==="admin"&&e.jsx("div",{className:" pb-5 w-[220px] md:m-auto",children:e.jsx("button",{onClick:()=>u("/admin"),className:"w-full px-3 py-3 bg-black text-white hover:text-blue-200 text-[12px] sm:text-[16px] lg:text-[20px] font-bold transition-all duration-300 border-2 border-gray-500 hover:border-blue-200",children:"Go to Admin Panel"})}),e.jsxs("div",{className:"flex flex-col lg:flex-row justify-center lg:w-[85%] xl:w-[1240px] items-start bg-black bg-opacity-80 border-2 border-gray-600 p-2",children:[e.jsxs("div",{className:"py-6 rounded-lg shadow-lg w-full m-auto md:max-w-sm text-white",children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold mb-2 text-center text-blue-200",children:"User Photo"}),e.jsx("p",{className:"text-center pb-5",children:"Upload a photo to use as your profile avatar."}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-56 h-56 rounded-full overflow-hidden border-2 border-gray-400",children:e.jsx("img",{src:a.user_photo?`https://hoodshop-project.onrender.com
${a.user_photo}`:"/img/default-avatar.jpg",alt:"Profilová fotka",className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:N,className:"bg-gray-700 hover:bg-gray-500 transition-colors text-sm py-2 px-2 rounded-lg font-semibold cursor-pointer",children:"Use Default Photo"}),e.jsxs("div",{className:"flex flex-col text-center items-center gap-2",children:[e.jsxs("label",{className:"bg-green-800 hover:bg-green-600 transition-colors py-3 px-5 rounded-lg font-semibold cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",ref:x,onChange:t=>{c(""),g(t.target.files[0])},className:"hidden"}),"Select Photo"]}),e.jsx("div",{className:"h-5",children:h&&e.jsx("p",{className:"text-md text-gray-100 italic",children:h.name})})]}),e.jsx("button",{onClick:w,className:"bg-green-800 hover:bg-green-600 transition-colors py-3 px-10 rounded-lg font-semibold cursor-pointer",disabled:!h,children:"Upload Photo"}),e.jsx("div",{className:"h-5",children:y&&e.jsx("div",{className:"text-red-500 text-center font-semibold",children:y})})]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-lg w-[92%] mx-auto md:max-w-2xl lg:max-w-3xl text-white",children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold mb-2 text-center text-blue-200",children:"Personal Information"}),e.jsx("p",{className:"text-sm lg:text-[16px] text-white my-5 pl-3",children:"Fill out your personal details below. These will be saved to your profile and automatically used during checkout to speed up the ordering process."}),e.jsxs("form",{className:"flex flex-col space-y-4",onSubmit:t=>{t.preventDefault(),S()},children:[T.map(({id:t,label:o,type:l,maxLength:s})=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx("label",{htmlFor:t,className:"block pl-3 lg:pl-0 lg:mb-0 lg:w-1/3 xl:w-1/4 text-md lg:text-lg text-white",children:o}),e.jsx("input",{type:l,id:t,name:t,placeholder:o,value:a[t]||"",onChange:k,maxLength:s,className:"w-full lg:w-2/3 p-3 pl-5  bg-gray-900 text-white border border-gray-500"})]},t)),e.jsx("div",{className:"py-2 w-full md:w-[220px] md:m-auto",children:e.jsx("button",{type:"submit",className:"w-full bg-green-800 hover:bg-green-600 transition-colors py-3 rounded-lg font-semibold",children:"Save Changes"})}),e.jsx("div",{className:"h-5 flex items-center justify-center",children:f&&e.jsx("div",{className:"text-green-500 text-center text-xl transition-opacity duration-300",children:f})})]})]})]}),e.jsxs("div",{className:"p-6 my-10 flex flex-col md:flex-row md:items-center md:justify-center w-full md:w-[90%] lg:w-[85%] xl:w-[1240px] text-white border-2 border-gray-600 bg-black bg-opacity-80 gap-4",children:[e.jsx("p",{className:"text-sm xl:text-[16px] text-gray-100 max-w-md mx-auto text-center md:text-left",children:"You can delete your account here, but be aware – all saved data associated with your account will be permanently lost."}),e.jsx("button",{onClick:()=>p(!0),className:"w-[90%] md:w-[220px] bg-red-700 hover:bg-red-600 text-white py-3 rounded-lg font-semibold transition- mx-auto",children:"Delete Account"})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-900 text-white rounded-lg shadow-lg p-6 w-[90%] max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-red-500",children:"Delete Account"}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete your account? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"}),e.jsx("button",{onClick:()=>{p(!1),v()},className:"px-4 py-2 bg-red-700 hover:bg-red-600 rounded",children:"Confirm Delete"})]})]})})]})]}):e.jsx("div",{children:"Načítavam..."})}export{E as default};
