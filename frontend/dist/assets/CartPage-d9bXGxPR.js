import{r as l,A as v,C as N,v as C,j as t,L as k,a as h}from"./index-C-hwXzSE.js";const I=()=>{const{user:o}=l.useContext(v),{refreshCartCount:c}=l.useContext(N),[i,d]=l.useState([]),[g,p]=l.useState(!0),[b,f]=l.useState(0),[n,y]=l.useState(null);l.useEffect(()=>{let e=localStorage.getItem("sessionId")||localStorage.getItem("session_id");e||(e=C(),localStorage.setItem("sessionId",e)),y(e)},[]),l.useEffect(()=>{if(!n)return;(async()=>{p(!0);try{const s={};o&&o.token?s.Authorization=`Bearer ${o.token}`:s["x-session-id"]=n;const a=await h.get("http://localhost:3001/api/cart",{headers:s});d(a.data),x(a.data),c()}catch(s){console.error("Failed to load cart:",s)}finally{p(!1)}})()},[o,n,c]);const x=e=>{const s=e.reduce((a,r)=>a+r.price*r.quantity,0);f(s)},j=async e=>{try{const s={};o&&o.token?s.Authorization=`Bearer ${o.token}`:s["x-session-id"]=n,await h.delete(`http://localhost:3001/api/cart/${e}`,{headers:s});const a=i.filter(r=>r.id!==e);d(a),x(a),c()}catch(s){console.error("Remove failed:",s)}},m=async(e,s)=>{if(!(s<1))try{const a={};o&&o.token?a.Authorization=`Bearer ${o.token}`:a["x-session-id"]=n,await h.patch(`http://localhost:3001/api/cart/${e}`,{quantity:s},{headers:a});const r=i.map(u=>u.id===e?{...u,quantity:s}:u);d(r),x(r),c()}catch(a){console.error("Update failed:",a)}};return g?t.jsx("p",{className:"p-4",children:"Loading cart..."}):i.length===0?t.jsx("p",{className:"p-4 pt-8 text-red-500 text-center text-xl",children:"Your cart is empty."}):t.jsxs("div",{className:"relative bg-cover bg-center md:py-16 min-h-screen",style:{backgroundImage:"url('/img/bg-shop.jpg')",backgroundAttachment:"fixed"},children:[t.jsx("div",{className:"absolute inset-0 bg-black opacity-40 z-0"}),t.jsxs("div",{className:"relative z-10 max-w-4xl mx-auto p-6 bg-black bg-opacity-60 lg:rounded-xl border-2 border-gray-500",children:[t.jsx("h1",{className:"text-3xl font-bold mb-4 text-center py-3 text-blue-200",children:"Shopping Cart"}),t.jsx("ul",{className:"space-y-4",children:i.map(e=>t.jsxs("li",{className:"flex flex-col sm:flex-row sm:items-center justify-between bg-gray-100 p-4 shadow rounded-lg space-y-4 sm:space-y-0",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:`http://localhost:3001${e.image}`,alt:e.name,className:"w-16 h-16 object-cover rounded"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-base sm:text-lg font-semibold",children:e.name}),t.jsxs("p",{className:"text-sm",children:["$",e.price]})]})]}),t.jsxs("div",{className:"flex items-center justify-center sm:justify-end space-x-2 sm:space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>m(e.id,e.quantity-1),className:"px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-lg",children:"âˆ’"}),t.jsx("span",{className:"min-w-[24px] text-center text-lg font-semibold",children:e.quantity}),t.jsx("button",{type:"button",onClick:()=>m(e.id,e.quantity+1),className:"px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-lg",children:"+"}),t.jsx("button",{type:"button",onClick:()=>j(e.id),className:"ml-2 text-red-500 text-[16px] hover:text-red-500 hover:scale-105",children:"Remove"})]})]},e.id))}),t.jsxs("div",{className:"text-center flex flex-col space-y-3 py-5",children:[t.jsxs("h2",{className:"text-white text-lg lg:text-2xl font-semibold",children:["Total: ",t.jsxs("span",{className:"text-green-500 text-2xl font-semibold",children:["$",b.toFixed(2)]})]}),t.jsx(k,{to:"/checkout",children:t.jsx("button",{type:"button",className:"w-full md:w-[50%] lg:w-80 lg:text-xl bg-green-700 hover:bg-green-600 text-white font-semibold py-3 rounded-xl",children:"Proceed to Checkout"})})]})]})]})};export{I as default};
